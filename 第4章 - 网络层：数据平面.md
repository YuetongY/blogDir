# 第4章 - 网络层：数据平面

网络层能够被分解为像个相互作用的部分：数据平面和控制平面

## 4.1 网络层概述

### 4.1.1 转发和路由选择：数据平面和控制平面

两种重要的网络层功能：

- 转发：是数据平面中实现的唯一功能。是指将分组从一个输入链路接口转移到适当的输出链路接口的路由器本地动作。转发发生的时间尺度很短（通常为几纳秒），因此通常用硬件来实现。

- 路由选择：在控制平面中实现。是指确定分组从源到目的地所采取的端到端路径的网络范围处理过程。路由选择发生的时间尺度长的多（通常为几秒），因此通常用软件来实现。

控制平面常用方法有：

- 传统的方法：路由选择算法运行在每台路由器中，并且每台路由器中都包含转发和路由选择两种功能。路由选择算法与其他路由器中的路由选择算法通信，以计算出它的转发表的值。

- SDN 方法：远程控制器计算和分发转发表以供每台路由器所使用。控制平面路由选择功能与物理的路由器是分离的，即路由选择设备仅执行转发，而远程控制器计算并分发转发表。

## 4.2 路由器工作原理

如下是一个通用路由器体系结构的总体视图：

![2](http://ww1.sinaimg.cn/large/006alGmrly1g2qsjflul1j31410k4ald.jpg)

- 输入端口：执行终结入物理链路的物理层功能。与位于链路远端的数据链路层交互来执行数据链路层功能。执行查找功能

- 交换结构：将路由器的输入端口连接到它的输出端口。（注意：这里的“端口”一次，指的是路由器的物理输入和输出接口）

- 输出端口：存储从交换结构接收的分组，并通过执行必要的链路层和物理层功能在输出链路上传输这些分组

- 路由选择处理器：执行控制平面功能

路由器的输入端口、输出端口和交换结构几乎总是用硬件实现。

转发分为：基于目的地转发和通用转发

## 4.3 网际协议：IPv4、寻址、IPv6 及其他