# 树和二叉树

## 树

树是由结点或顶点和边组成的(可能是非线性的)且不存在着任何环的一种数据结构。没有结点的树称为空(null或empty)树。一棵非空的树包括一个根结点，还(很可能)有多个附加结点，所有结点构成一个多级分层结构。

![image.png](https://ws1.sinaimg.cn/large/006alGmrly1g9gccegglqj309a06z74g.jpg)

![image.png](https://ws1.sinaimg.cn/large/006alGmrly1g9gcdjx5lpj30r20ox427.jpg)

---

## 二叉树

每个结点至多拥有两棵子树(即二叉树中不存在度大于2的结点)，并且，二叉树的子树有左右之分，其次序不能任意颠倒。

**性质**：

1. 若二叉树的层次从0开始，则在二叉树的第i层至多有2^i个结点(i>=0)。

2. 高度为k的二叉树最多有2^(k+1) - 1个结点(k>=-1)。 (空树的高度为-1)

3. 对任何一棵二叉树，如果其叶子结点(度为0)数为m, 度为2的结点数为n, 则m = n + 1。

**完美二叉树**：

![image.png](https://ws1.sinaimg.cn/large/006alGmrly1g9gcf699q4j30oc08jt9z.jpg)

**完全二叉树**：

![image.png](https://ws1.sinaimg.cn/large/006alGmrly1g9gcfqf0ivj30mv08raaa.jpg)

**完满二叉树(Full Binary Tree)**：

![image.png](https://ws1.sinaimg.cn/large/006alGmrly1g9gcgeyc2jj30hc09rdg3.jpg)

**平衡（AVL）二叉树**：

- 它的左子树和右子树都是平衡二叉树，且左子树和右子树的深度之差的绝对值不超过1。

- 若将二叉树节点的平衡因子BF定义为该节点的左子树的深度减去它的右子树的深度，则平衡二叉树上所有节点的平衡因子只可能为-1,0,1.

- 只要二叉树上有一个节点的平衡因子的绝对值大于1，那么这颗平衡二叉树就失去了平衡。

![image.png](https://ws1.sinaimg.cn/large/006alGmrly1g9jqwvlgyxj30hr0ehju5.jpg)

总结一下二叉排序树的不平衡情况以及如何将其转化为平衡情况。
一般情况下，假设由于在二叉排序树上插入结点而失去平衡的最小子树根结点的指针为a（即a是离插入结点最近，且平衡因子绝对值不超过1的祖先结点），则失去平衡后进行调整的规律可以归纳为一下4种情况：

![image.png](https://ws1.sinaimg.cn/large/006alGmrly1g9jr2eh05fj30kt0e00w0.jpg)

**参考**：

- [完美二叉树, 完全二叉树和完满二叉树](https://blog.csdn.net/qq_22642239/article/details/80774013)

---

## 二叉搜索树

1.所有非叶子结点至多拥有两个儿子（Left和Right）；

2.所有结点存储一个关键字；

3.非叶子结点的左指针指向小于其关键字的子树，右指针指向大于其关键字的子树；

![image.png](https://ws1.sinaimg.cn/large/006alGmrly1g9jn6m35r5j307507egmu.jpg)

二叉搜索树的搜索，从根结点开始，如果查询的关键字与结点的关键字相等，那么就命中；否则，如果查询关键字比结点关键字小，就进入左儿子；如果比结点关键字大，就进入右儿子；如果左儿子或右儿子的指针为空，则报告找不到相应的关键字；

==如果二叉搜索树的所有非叶子结点的左右子树的结点数目均保持差不多（平衡），那么B树的搜索性能逼近二分查找；但它比连续内存空间的二分查找的优点是，改变二叉搜索树结构（插入与删除结点）不需要移动大段的内存数据，甚至通常是常数开销；==

![image.png](https://ws1.sinaimg.cn/large/006alGmrly1g9jn8q8mvrj30f209ggoa.jpg)

但二叉搜索树在经过多次插入与删除后，有可能导致不同的结构：

![image.png](https://ws1.sinaimg.cn/large/006alGmrly1g9jn96y7waj30du079768.jpg)

右边也是一个二叉搜索树，但它的==搜索性能已经是线性的了==；==同样的关键字集合有可能导致不同的树结构索引==；所以，==使用二叉搜索树还要考虑尽可能让B树保持左图的结构，和避免右图的结构，也就是所谓的“平衡”问题；==

==实际使用的二叉搜索树都是在原二叉搜索树的基础上加上平衡算法，即“平衡二叉树”；如何保持B树结点分布均匀的平衡算法是平衡二叉树的关键；平衡算法是一种在二叉搜索树中插入和删除结点的策略；==

### B树（B-树）

B树和平衡二叉树稍有不同的是B树属于多叉树又名平衡多路查找树（查找路径不只两个），数据库索引技术里大量使用者B树和B+树的数据结构

**规则**：

（1）排序方式：所有节点关键字是按递增次序排列，并遵循左小右大原则；

（2）子节点数：非叶节点的子节点数>1，且<=M ，且M>=2，空树除外（注：M阶代表一个树节点最多有多少个查找路径，M=M路,当M=2则是2叉树,M=3则是3叉）；

（3）关键字数：枝节点的关键字数量大于等于ceil(m/2)-1个且小于等于M-1个（注：ceil()是个朝正无穷方向取整的函数 如ceil(1.1)结果为2);

（4）所有叶子节点均在同一层、叶子节点除了包含了关键字和关键字记录的指针外也有指向其子节点的指针只不过其指针地址都为null对应下图最后一层节点的空格子;

![image.png](https://ws1.sinaimg.cn/large/006alGmrgy1g9jrylzaaqj30hd07qtbq.jpg)

### B+树

B+树是B树的一个升级版，相对于B树来说B+树更充分的利用了节点的空间，让查询速度更加稳定，其速度完全接近于二分法查找。

（1）B+跟B树不同B+树的非叶子节点不保存关键字记录的指针，只进行数据索引，这样使得B+树每个非叶子节点所能保存的关键字大大增加；

（2）B+树叶子节点保存了父节点的所有关键字记录的指针，所有数据地址必须要到叶子节点才能获取到。所以每次数据查询的次数都一样；

（3）B+树叶子节点的关键字从小到大有序排列，左边结尾数据都会保存右边节点开始数据的指针。

![image.png](https://ws1.sinaimg.cn/large/006alGmrgy1g9jsbjzid0j30g509zn2d.jpg)

**特点**：

1、B+树的层级更少：相较于B树B+每个非叶子节点存储的关键字数更多，树的层级更少所以查询数据更快；

2、B+树查询速度更稳定：B+所有关键字数据地址都存在叶子节点上，所以每次查找的次数都相同所以查询速度要比B树更稳定;

3、B+树天然具备排序功能：B+树所有的叶子节点数据构成了一个有序链表，在查询大小区间的数据时候更方便，数据紧密性很高，缓存的命中率也会比B树高。

4、B+树全节点遍历更快：B+树遍历整棵树只需要遍历所有的叶子节点即可，，而不需要像B树一样需要对每一层进行遍历，这有利于数据库做全表扫描。

==B树相对于B+树的优点==是，如果经常访问的数据离根节点很近，而B树的非叶子节点本身存有关键字其数据的地址，所以这种数据检索的时候会要比B+树快。

### B*树

是B+树的变体，在B+树的非根和非叶子结点再增加指向兄弟的指针

![image.png](https://ws1.sinaimg.cn/large/006alGmrgy1g9jsjp753aj30g909sgr2.jpg)

B*树定义了非叶子结点关键字个数至少为(2/3)*M，即块的最低使用率为2/3（代替B+树的1/2）；

B+树的分裂：当一个结点满时，分配一个新的结点，并将原结点中1/2的数据复制到新结点，最后在父结点中增加新结点的指针；B+树的分裂只影响原结点和父结点，而不会影响兄弟结点，所以它不需要指向兄弟的指针；

B*树的分裂：当一个结点满时，如果它的下一个兄弟结点未满，那么将一部分数据移到兄弟结点中，再在原结点插入关键字，最后修改父结点中兄弟结点的关键字（因为兄弟结点的关键字范围改变了）；如果兄弟也满了，则在原结点与兄弟结点之间增加新结点，并各复制1/3的数据到新结点，最后在父结点增加新结点的指针；

==所以，B*树分配新结点的概率比B+树要低，空间使用率更高==

**小结**：

1. B（B-）树：多路搜索树，每个结点存储M/2-1（去上整）到M-1个关键字，非叶子结点存储指向关键字范围的子结点；所有关键字在整颗树中出现，且只出现一次，非叶子结点可以命中；

2. B+树：在B-树基础上，为叶子结点增加链表指针，所有关键字都在叶子结点中出现，非叶子结点作为叶子结点的索引；B+树总是到叶子结点才命中；

3. B*树：在B+树基础上，为非叶子结点也增加链表指针，将结点的最低利用率从1/2提高到2/3

**参考**：

- [平衡二叉树、B树、B+树、B*树 理解其中一种你就都明白了](https://zhuanlan.zhihu.com/p/27700617)

- [B树、B-树、B+树、B*树](https://blog.csdn.net/qq_28584889/article/details/88777393)

---
