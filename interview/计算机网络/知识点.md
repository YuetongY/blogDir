[toc]

# 知识点

## TCP 和 UDP 的区别

1. TCP面向连接（如打电话要先拨号建立连接）;UDP是无连接的，即发送数据之前不需要建立连接

2. TCP提供可靠的服务。也就是说，通过TCP连接传送的数据，无差错，不丢失，不重复，且按序到达;UDP尽最大努力交付，即不保证可靠交付

3. 每一条TCP连接只能是点到点的;UDP支持一对一，一对多，多对一和多对多的交互通信

4. TCP首部开销20字节;UDP的首部开销小，只有8个字节

---

## TCP 三次握手和四次挥手，为什么

- 为什么是两次握手不是三次握手（下面链接里面的答案不对，这里的才是对的）

    三次握手可以防止已经失效的连接请求报文突然又传输到服务器端导致的服务器资源浪费。例如，客户端先发送了一个SYN，但是由于网络阻塞，该SYN数据包在某个节点长期滞留。然后客户端又重传SYN数据包并正确建立TCP连接，然后传输完数据后关闭该连接。该连接释放后失效的SYN数据包才到达服务器端。在二次握手的前提下，服务器端会认为这是客户端发起的又一次请求，然后发送SYN ，并且在服务器端创建socket套接字，一直等待客户端发送数据。但是由于客户端并没有发起新的请求，所以会丢弃服务端的SYN 。此时服务器会一直等待客户端发送数据从而造成资源浪费。 

- [TCP的三次握手与四次挥手理解及面试题（很全面）](https://blog.csdn.net/qq_38950316/article/details/81087809)

---

## 为什么tcp三次握手的时候的seq初始化时随机地，而不是从0开始

tcp三次握手的过程中，如果硬编码，也就是写死seq序列，如果主机A和B频繁的建立连接，传送一些TCP报文后断开链接，如果主机A中一些TCP报文在网络中滞留较长时间，主机A会重传这些报文，链接释放后，重新建立新的链接，那么之前这些滞留较长时间的报文会到达主机B，但是这些报文的链接早就释放了，B应该回复RST。但是由于seq序列写死，每次链接的seq序列都是一致的，那么主机B可能会接受这些过时的，无意义的报文，结果产生错误。

**参考**：[https://www.nowcoder.com/discuss/410212?type=0&order=0&pos=7&page=1](https://www.nowcoder.com/discuss/410212?type=0&order=0&pos=7&page=1)

---

## TCP如何保证传输的可靠性

- 校验和

- 序列号

- 确认应答

- 超时重传

- 连接管理

- 流量控制

- 拥塞控制

**参考**：[网络基础：TCP协议-如何保证传输可靠性](https://blog.csdn.net/liuchenxia8/article/details/80428157)

---

## TCP的拥塞控制，具体过程是怎么样的？UDP有拥塞控制吗？如何解决

**参考**：[网络基础：TCP协议-如何保证传输可靠性](https://blog.csdn.net/liuchenxia8/article/details/80428157)

---

## session 在服务器上以怎样的形式存在

可以存储在内存中。不过也可以做持久化存储。如：文件、数据库等。

**参考**：[Session是怎么实现的？存储在哪里？](https://blog.csdn.net/qq_15096707/article/details/74012116?utm_source=distribute.pc_relevant.none-task)

---

## Http与Https的区别

1、https协议需要到CA  （Certificate Authority，证书颁发机构）申请证书，一般免费证书较少，因而需要一定费用。

2、http是超文本传输协议，信息是明文传输，https则是具有安全性的ssl加密传输协议。

3、http和https使用的是完全不同的连接方式，用的端口也不一样，前者是80，后者是443。

4、http的连接很简单，是无状态的。Https协议是由SSL+Http协议构建的可进行加密传输、身份认证的网络协议，比http协议安全。

**参考**：[Http和Https的区别（面试常考题）](https://blog.csdn.net/qq_38289815/article/details/80969419)

---

## HTTP状态码分类

- 1**：信息，服务器收到请求，需要请求者继续执行操作

- 2**：成功，操作被成功接收并处理

- 3**：重定向，需要进一步的操作以完成请求

- 4**：客户端错误，请求包含语法错误或无法完成请求

- 5**：服务器错误，服务器在处理请求的过程中发生了错误

**参考**：[HTTP状态码](https://www.runoob.com/http/http-status-codes.html)

---

## Socket 编程

Socket 是一种面向网络的编程方式，它介于应用层和传输层之间。也是计算机网络中用于在节点内发送或接收数据的内部端点。

![image.png](https://ww1.sinaimg.cn/large/006alGmrgy1gch2wvky1pj30o80i678n.jpg)

**参考**：[socket编程到底是什么？](https://www.zhihu.com/question/29637351/answer/534704474)

---

## http 通信过程

1. 建立TCP连接

2. Web浏览器向Web服务器发送请求命令

3. Web服务器应答

4. Web服务器关闭TCP连接

5. 浏览器接受到服务器响应的数据

**总结流程**：

浏览器发起请求-> 解析域名得到ip进行TCP连接 ->浏览器发送HTTP请求和头信息发送->服务器对浏览器进行应答，响应头信息和浏览器所需的内容-> 关闭TCP连接或保持-> 浏览器得到数据数据进行操作

**参考**：

- [一次完整的HTTP请求所经历的步骤](https://www.jianshu.com/p/ae62574f7a99)

- [更完整的 HTTP 通信过程](https://www.cnblogs.com/ghl1024/p/12080532.html)

---

## HTTP 报文格式

1. 请求报文

    HTTP请求报文由**请求行（request line）、请求头（header）、空行和请求体4个部分组成**。

    空行的作用是通知服务器以下不再有请求头。

    请求行中有**请求方法、URL、http 协议版本**

2. 响应报文

    HTTP响应报文和请求报文的结构类似，也是由四个部分组成：**响应行、消息报头、空行、响应体**。

    响应行也由三部分组成：**服务器HTTP协议版本，响应状态码，状态码的文本描述**

**参考**：

- [HTTP报文格式](https://www.cnblogs.com/Mr-mubai/p/11603520.html)

- [Http协议报文格式](https://www.cnblogs.com/jpfss/p/10984966.html)

---

## https 通信过程

一个HTTPS请求实际上包含了两次HTTP传输，可以细分为8步。

1. 客户端向服务器发起HTTPS请求，连接到服务器的443端口

2. 服务器端有一个密钥对，即公钥和私钥，是用来进行非对称加密使用的，服务器端保存着私钥，不能将其泄露，公钥可以发送给任何人。

3. 服务器将自己的公钥发送给客户端。

4. 客户端收到服务器端的公钥之后，会对公钥进行检查，验证其合法性，如果发现发现公钥有问题，那么HTTPS传输就无法继续。严格的说，这里应该是验证服务器发送的数字证书的合法性。如果公钥合格，那么客户端会生成一个随机值，这个随机值就是用于进行对称加密的密钥，我们将该密钥称之为client key，即客户端密钥，这样在概念上和服务器端的密钥容易进行区分。然后用服务器的公钥对客户端密钥进行非对称加密，这样客户端密钥就变成密文了，至此，HTTPS中的第一次HTTP请求结束。

5. 客户端会发起HTTPS中的第二个HTTP请求，将加密之后的客户端密钥发送给服务器。

6. 服务器接收到客户端发来的密文之后，会用自己的私钥对其进行非对称解密，解密之后的明文就是客户端密钥，然后用客户端密钥对数据进行对称加密，这样数据就变成了密文。

7. 然后服务器将加密后的密文发送给客户端。

8. 客户端收到服务器发送来的密文，用客户端密钥对其进行对称解密，得到服务器发送的数据。这样HTTPS中的第二个HTTP请求结束，整个HTTPS传输完成。

![image.png](https://ww1.sinaimg.cn/large/006alGmrgy1gcsphfe9tvj30qq0yi7b9.jpg)

**参考**：

- [Https原理及流程](https://www.jianshu.com/p/14cd2c9d2cd2)

- [HTTPS安全通信过程](https://www.cnblogs.com/xtiger/p/11026870.html)

---

## ssl 和 tls 的区别

**ssl**：SSL是基于HTTP之下TCP之上的一个协议层，是基于HTTP标准并对TCP传输数据时进行加密，所以HPPTS是HTTP+SSL/TCP的简称。它是一项标准技术，可确保互联网连接安全，保护两个系统之间发送的任何敏感数据，防止网络犯罪分子读取和修改任何传输信息，包括个人资料。

**tls**：TLS（传输层安全Transport Layer Security）是更为安全的升级版 SSL。

**差异**：

1）版本号：TLS记录格式与SSL记录格式相同，但版本号的值不同，TLS的版本1.0使用的版本号为SSLv3.1。

　　2）报文鉴别码：SSLv3.0和TLS的MAC算法及MAC计算的范围不同。TLS使用了RFC-2104定义的HMAC算法。SSLv3.0使用了相似的算法，两者差别在于SSLv3.0中，填充字节与密钥之间采用的是连接运算，而HMAC算法采用的是异或运算。但是两者的安全程度是相同的。

　　3）伪随机函数：TLS使用了称为PRF的伪随机函数来将密钥扩展成数据块，是更安全的方式。

　　4）报警代码：TLS支持几乎所有的SSLv3.0报警代码，而且TLS还补充定义了很多报警代码，如解密失败（decryption_failed）、记录溢出（record_overflow）、未知CA（unknown_ca）、拒绝访问（access_denied）等。

　　5）密文族和客户证书：SSLv3.0和TLS存在少量差别，即TLS不支持Fortezza密钥交换、加密算法和客户证书。

　　6）certificate_verify和finished消息：SSLv3.0和TLS在用certificate_verify和finished消息计算MD5和SHA-1散列码时，计算的输入有少许差别，但安全性相当。

　　7）加密计算：TLS与SSLv3.0在计算主密值（master secret）时采用的方式不同。

　　8）填充：用户数据加密之前需要增加的填充字节。在SSL中，填充后的数据长度要达到密文块长度的最小整数倍。而在TLS中，填充后的数据长度可以是密文块长度的任意整数倍（但填充的最大长度为255字节），这种方式可以防止基于对报文长度进行分析的攻击。

**参考**：

- [HTTPS、SSL、TLS三者之间的联系和区别](https://blog.csdn.net/enweitech/article/details/81781405)

- [SSL与TLS的区别](https://www.cnblogs.com/feng9exe/p/8060349.html)

---

## tls 验证过程

**证书机制/证书验证**：

![image.png](https://ww1.sinaimg.cn/large/006alGmrgy1gdcuba7xg3j30qd095qb8.jpg)

1. 客户端获取到了站点证书，拿到了站点的公钥；

2. 要验证站点可信后，才能使用其公钥，因此客户端找到其站点证书颁发者的信息；

3. 站点证书的颁发者验证了服务端站点是可信的，但客户端依然不清楚该颁发者是否可信；

4. 再往上回溯，找到了认证了中间证书商的源头证书颁发者。由于源头的证书颁发者非常少，我们浏览器之前就认识了，因此可以认为根证书颁发者是可信的；

5. 一路倒推，证书颁发者可信，那么它所颁发的所有站点也是可信的，最终确定了我们所访问的服务端是可信的；

6. 客户端使用证书中的公钥，继续完成TLS的握手过程。

**客户端可以通过两种方法验证证书的有效性**：

1. **CRL（Certificate Revocation List）即证书撤销名单**:证书颁发者会提供一份已经失效证书的名单，供浏览器验证证书使用。当然这份名单是巨长无比的，浏览器不可能每次TLS都去下载，所以常用的做法是浏览器会缓存这份名单，定期做后台更新。这样虽然后台更新存在时间间隔，证书失效不实时，但一般也OK。

2. **OCSP(Online Certificate StatusProtocol)即在线证书状态协议**:除了离线文件，证书颁发者也会提供实时的查询接口，查询某个特定证书目前是否有效。实时查询的问题在于浏览器需要等待这个查询结束才能继续TLS握手，延迟会更大。

**参考**:[HTTPS加密过程和TLS证书验证](https://www.jianshu.com/p/f6b34381beac)

---

## 应用层协议有哪些

- 域名系统(Domain Name System，DNS)：用于实现网络设备名字到IP地址映射的网络服务。

    ==一般情况下使用UDP进行域名解析服务，也可以用TCP==

    **区域传送时使用TCP，主要有一下两点考虑**：
    1.辅域名服务器会定时（一般时3小时）向主域名服务器进行查询以便了解数据是否有变动。如有变动，则会执行一次区域传送，进行数据同步。区域传送将使用TCP而不是UDP，因为数据同步传送的数据量比一个请求和应答的数据量要多得多。
    2.TCP是一种可靠的连接，保证了数据的准确性。

    **域名解析时使用UDP协议：**
    客户端向DNS服务器查询域名，一般返回的内容都不超过512字节，用UDP传输即可。不用经过TCP三次握手，这样DNS服务器负载更低，响应更快。虽然从理论上说，客户端也可以指定向DNS服务器查询的时候使用TCP，但事实上，很多DNS服务器进行配置的时候，仅支持UDP查询包。

- 文件传输协议(File Transfer Protocol，FTP)：用于实现交互式文件传输功能。

- 简单邮件传送协议(Simple Mail Transfer Protocol, SMTP)：用于实现电子邮箱传送功能。

    使用 TCP 提供可靠数据传输

- 超文本传输协议(HyperText Transfer Protocol，HTTP)：用于实现WWW服务。

- 简单网络管理协议(simple Network Management Protocol，SNMP)：用于管理与监视网络设备。

- 远程登录协议(Telnet)：用于实现远程登录功能。

- 动态主机配置协议（DHCP)：为主机配置IP；包括手动分配、自动分配和动态分配。

**参考**：

- [应用层协议有哪些？](https://zhidao.baidu.com/question/578099657.html)

- [DNS使用的是TCP协议还是UDP协议](https://blog.csdn.net/qq100440110/article/details/50908992)

---

## 动态主机配置协议(DHCP)

对IP地址进行自动设置与统一分配

DHCP服务器可提供三种地址分配：

- 手动分配
    由网络管理员在DHCP服务器手工配置DHCP客户机的IP地址。

- 自动分配
    当DHCP客户机第一次向DHCP服务器请求到IP地址后，这个地址就永久地分配给了该DHCP客户机，不可撤销。

- 动态分配（最常见）
    与自动分配采用相同的方法，只不过获得的IP地址是有租约期限的，一旦租约到期，地址就会被回收，不过可以通过续订租约以延长期限。

**4个阶段**：

- 发现阶段（discover）：

    由于不知DHCP服务器的IP地址和Mac地址，DHCP客户机通过向本地网络广播一个DHCP DISCOVER请求报文以向网络中的DHCP服务器请求网络配置信息。

- 提供阶段（offer）：

    当DHCP服务器收到发现报文，它就从它的地址池中选出一个空闲IP填充到DHCP OFFER的"Your" IP address字段，并在选项字段加上子网掩码，路由器，DNS，服务器标识，IP地址租用时间等字段。再广播此报文（因为此时还不知客户机的IP地址）

- 请求阶段（request）：

    最后客户机可能会收到多个DHCP服务器的DHCP OFFER报文，一般是选最先到达那个报文并作出回应请求，即广播发出一个 包含服务器选项字段的DHCP REQUEST报文。这里还使用广播的目的是因为要让所有的DHCP服务器知道客户机选择了哪个服务器提供的IP。

- ACK阶段：

    DHCP服务器收到来自客户机的DHCP REQUEST报文，而只有符合服务器标识这个选项字段的DHCP服务器才会对此作出响应：

    如果服务器可以分配此IP则以DHCP ACK报文进行响应。
    如果服务器无法分配此IP则以DHCP NAK报文进行响应。

**参考**：[动态主机配置协议(DHCP)](https://www.jianshu.com/p/9b6b17be7413)

---

## HTTP 1.0 、1.1、2.0 区别

没写，下次补充

---

## NAT（网络地址转换）

**参考**：[NAT(地址转换技术)详解](https://blog.csdn.net/gui951753/article/details/79593307)

---
