# 大文件排序问题

## 1. 数字排序问题

**题目**：有一个大文件，里面记录了若干数字，把这些数字进行排序。文件大小远大于内存大小。
**思路**：内存极少的情况下，利用分治策略，利用外存保存中间结果，再用多路归并来排序。

（1）按可用内存的大小，把外存上含有n个记录的文件分成若干个长度为L的子文件，把这些子文件依次读入内存，并利用有效的内部排序方法对它们进行排序，再将排序后得到的有序子文件重新写入外存；

（2）对这些有序子文件逐趟归并，使其逐渐由小到大，直至得到整个有序文件为止。

## 2. 字符串重复次数问题

**问题**：有一个1.3GB的文件(共一亿行)，里面每一行都是一个字符串，请在文件中找出重复次数最多的字符串。

**基本思想**：迭代读大文件，把大文件拆分成多个小文件；最后再归并这些小文件。

**拆分的规则**：

  迭代读大文件，内存中维护一个字典，key是字符串，value是该字符串出现的次数；

当字典维护的字符串种类达到10000（可自定义）的时候，把该字典按照key从小到大排序，然后写入小文件，每行是 key\tvalue；

然后清空字典，继续往下读，直到大文件读完。

**归并的规则**：

  首先获取全部小文件的文件描述符，然后各自读出第一行（即每个小文件字符串ascii值最小的字符串），进行比较。

找出ascii值最小的字符串，如果有重复的，这把各自出现的次数累加起来，然后把当前字符串和总次数存储到内存中的一个列表。

然后把最小字符串所在的文件的读指针向下移，即从对应小文件里再读出一行进行下一轮比较。

当内存中的列表个数达到10000时，则一次性把该列表内容写到一个最终文件里存储到硬盘上。同时清空列表，进行之后的比较。

一直到读完全部的小文件，那么最后得到的最终文件就是一个按照字符串ascii值升序排序的大的文件，每一行的内容就是 字符串\t重复次数，

最后迭代去读这个最终文件，找出重复次数最多的即可。

**参考**：

- [大文件排序问题](https://blog.csdn.net/okiwilldoit/article/details/80626508)
- [大文件排序/外存排序问题](https://www.cnblogs.com/standby/p/9780910.html)