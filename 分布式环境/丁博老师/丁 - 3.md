# 丁博老师 第3章 原理 第一讲:预备知识 (TCP/IP协议与Socket API)

## 1. 互联网与TCP/IP协议

### 1.1 什么是协议

协议是计算机之间事先达成的“约定”

### 1.2 协议三要素

- 语法：规定信息格式,包括数据及控制信息格式、编码方式等

- 语义：说明通信双方应当如何做,用于协调与差错处理时的控制信息
- 时序：对事件发生顺序的详细说明,包括何时进行通信、先讲什么、后讲什么、讲话的速度等

### 1.3 TCP/UDP协议

- 传输层

1. 建立源主机和目标主机上之间的会话
2. TCP协议(Transport Control Protocol)
    - 在IP层之上引入抽象的“连接”概念
    - 面向数据流、有连接、可靠、有序的数据传输协议
3. UDP协议(User Datagram Protocol)
    - 对IP层的简单封装
    - 面向数据报、无连接、不可靠、无序的数据传输协议

### 1.4 IP协议

- 网络层

    1. 将数据包从源主机传送到目标主机
    2. IP协议
        - 定义了IP地址和网际互联层数据包格式
        - 使用IP地址将数据投递到正确的计算机上

## 2. Socket网络编程模型

### 2.1 从网络到分布式系统

- 分布式系统
    1. 由多个计算机及其上软件构件所组成,通过网络互联,通过消息通信进行协同

### 2.2 端口

- TCP使用的端口号共有65535个
    1. 系统端口:范围为0~1023。其中的0和255是保留端口号,1~254用于频繁使用的进程
    2. 用户端口:范围为1024~49151
    3. 动态和私有端口:范围为49152~65535。

### 2.3 套接字

- 套接字
    1. 计算机网络中进程间数据流的端点,是操作系统提供的进程间一种通信机制
    2. 套接字地址:IP地址+端口号
    3. 套接字API:实现进程间通信的手段,使得网络读写数据(或者服务调用)和读写本地文件一样容易

## 3. 线程并发

### 3.1 线程的概念

引子:每个应用就是一个进程。

一个进程中可以只有一个线程，也可以有多个线程

### 3.2 为什么要多线程

1. 不同的并发抽象

2. 充分发挥现代CPU的能力

### 3.3 线程的实现:以Windows为例

- 线程就是一个用于运行代码的WIN32对象。
    1. 线程是进程的一条执行路径,它包含独立的堆栈和CPU寄存器状态,每个线程共享所有的进程资源,包括打开的文件、信号标识及动态分配的内存等。
- 进程与线程的实现区别
    1. 当Win32创建一个新的进程时,它只是在内存中建立一个映象文件把Exe文件或DLL文件、Active X文件中的内容复制到内存中。
    2. 进程是不活动的,而实际操作是由线程来进行的,线程是工作者。
    3. 运行代码是线程的,而进程为线程提供地址空间和运行所需要的数据。
- WIN32是一种抢占式多任务操作系统,它为每一个线程轮流分配时间段,让线程在分配的时间段里运行。
- 系统的每个线程都有一个Context记录,一个Context记录包含的是线程运行时CPU寄存器状态信息的数据结构
    1. 当一个线程被唤醒时,它的Context记录就被载入到CPU中,这样线程便在当前指令指针指向的地址开始执行。
    2. 当分配的时间片结束,CPU寄存器的值存入此线程的Context记录中,等待下一个属于它的时间片到来。而下一线程的Context记录被载入CPU,开始运行。
- 一个进程内的所有线程使用同一个地址空间,而这些线程
的执行由系统调度程序控制,调度程序决定哪个线程可执
行以及什么时候执行线程。
- 线程有优先级别,优先权较低的线程必须等到优先权较高
的线程执行完后再执行。

### 3.4 线程的同步

- 同步机制相当于线程之间的红绿灯
    1. 完成线程间数据共享和同步
