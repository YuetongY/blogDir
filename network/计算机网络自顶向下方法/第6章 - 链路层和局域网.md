# 第6章 - 链路层和局域网

## 6.1 链路层概述

节点：包括主机、路由器、交换机和 WiFi 接入点。

链路：沿着通信路径连接相邻节点的通信信道

### 6.1.1 链路层提供的服务

- 成帧（framing）：几乎所有链路层协议都可以将数据报用链路层帧封装起来。不同链路层协议，可能帧的格式会不一样

- 链路接入：媒体访问控制（Medium Access Control，MAC）协议规定了帧在链路上传输的规则

- 可靠交付：目的是本地（也就是在差错发生的链路上）纠正一个差错，而不是通过运输层或应用层协议迫使进行端到端的数据重传

- 差错检测和纠正：差错纠正类似于差错检测，区别在于接收方不仅能检测帧中出现的比特差错，而且能够准确的确定帧中的差错出现的位置（并因此纠正这些差错）

### 6.1.2 链路层在何处实现

对于路由器：链路层实现在其线路卡中

对于主机：链路层的主体部分在网络适配器（network adapter）中实现，网络适配器有时也称为网络接口卡（Network Interface Card，NIC）。位于网络适配器核心的是链路层控制器，该控制器通常是一个实现了许多链路层服务的专用芯片

链路层是硬件和软件的结合体

## 6.2 差错检测和纠正技术

3 种技术：

1. 奇偶校验：描述差错检测和纠正背后隐含的基本思想

2. 检验和方法：更多地应用于运输层

3. 循环冗余检测：通常更多地应用在适配器中的链路层

## 6.3 多路访问链路和协议

两种类型的网路链路：

- 点对点链路：链路一段的单个发送方和链路另一端的单个接收方组成

- 广播链路：多个发送和接收节点都连接到相同的、单一的、共享的广播信道。

多路访问问题：如何协调多个发送和接收节点对一个共享广播信道的访问

三种类型的多路访问协议：信道划分协议、随机接入协议和轮流协议

## 6.4 交换局域网

交换机网络使用链路层地址而不是 IP 地址来转发链路层帧

### 6.4.1 链路层寻址和 ARP

#### 6.4.1.1 MAC 地址

链路层地址位于 `适配器（网络接口）`，链路层交换机没有链路层地址

链路层地址又称为：LAN 地址（LAN address）、物理地址（physical address） 或 MAC 地址（MAC address）

MAC 地址长度为 6 字节，用十六进制表示法

交换机可能会将一个入帧广播到它的所有接口。因此一块适配器可以接收一个并非向它寻址的帧。当适配器接收到一个帧时，将检查该帧中的目的 MAC 地址是否与它自己的 MAC 地址匹配。

特殊的广播地址（需要所有适配器接收和处理）：`FF-FF-FF-FF-FF-FF`

#### 6.4.1.2 地址解析协议

地址解析协议（Address Resolution Protocol，ARP)：提供将 IP 地址转换为链路层地址的机制

ARP 与 DNS 的区别：ARP 只为在同一个子网上的主机和路由器接口解析 IP 地址，而 DNS 为在因特网中的任何地方的主机解析主机名。

### 6.4.2 以太网

局域网技术包括：以太网、令牌环、FDDI 和 ATM。其中以太网几乎占领着现有的有线局域网市场

以太网发展史：

1. 初始以太网使用同轴电缆总线来互联节点。这种总线拓扑的以太网是一种广播局域网，即所有传输的帧传送到与该总线连接的所有适配器并被其处理

2. 之后的以太网基于集线器的星形拓扑结构。集线器是一种物理层设备。此外，它仍然是一个广播局域网

3. 当今以太网继续使用星形拓扑，但是位于中心的集线器被交换机（switch）所替代

#### 6.4.2.1 以太网帧结构

![2](http://ww1.sinaimg.cn/large/006alGmrly1g2u7rquardj30sp06cdjh.jpg)

- 数据字段（46 ~ 1500 字节）：承载 IP 数据报

- 目的地址（6 字节）：目的适配器的 MAC 地址

- 源地址（6 字节）：传输该帧到局域网上的适配器的 MAC 地址

- 类型字段（2 字节）：允许以太网复用多种网络层协议

- CRC（4 字节）：是接收适配器检测帧中是否引入了差错

- 前同步码（8 字节）：前 7 字节用于 “唤醒” 接收适配器，并且将他们的时钟和发送方的时钟同步。

#### 6.4.2.2 以太网技术

以太网是链路层也是物理层的规范，并且能够经各种物理媒体（包括同轴电缆、铜线和光纤）承载

### 6.4.3 链路层交换机

交换机的任务是接收入链路层帧并将它们转发到出链路

#### 6.4.3.1 交换机转发和过滤

过滤：决定一个帧应该转发到某个接口还是应当将其丢弃

转发：决定一个帧应该被导向哪个接口，并吧该帧移动到那些接口

交换机表包含：

1. MAC 地址

2. 通向该 MAC 地址的交换机接口

3. 表项放置在表中的时间

![2](http://ww1.sinaimg.cn/large/006alGmrly1g2u8c9a141j30ux08dq70.jpg)

#### 6.4.3.2 自学习

交换机的表是自动、动态和自治地建立的

交换机是 `即插即用设备`，因为他们不需要网络管理员或用户的干预

