# BBCP: A Blockchain based Open Source Contribution Protection System

## 1. Introduction

基于开源贡献保护的区块链系统

## 2. The architecture of the proposed BBCP platform

为了更好的保护开源世界中大众协同开发的知识成果，维护大众的利益，我们提出了BBCP平台。如图1，它由三个部分组成：Client、Trustie 以及 Fabric Network

Client ，也叫 Chain Tool， 就是一个基于 Nodejs 编写的工具，供开发人员在日常开发任务中使用。该工具允许开发人员同 Fabric Network 以及 Trustie 进行交互。此外，它集成了所有的 git 命令，可以像使用 git 一样方便的对本地 Repo 进行操作。它有两个版本，master 版本主要由开发人员使用，兼容针对 git 版本库操作的所有命令。此外，它还支持 token 查询，用户创建等基础性功能。trustie 版本则只部署在 Trustie 服务端。现阶段主要提供 pull request 功能支持。当 Trustie 服务端收到 PR 请求时，会调用该方法，将用户对开源版本库所作的贡献转换为一定数量的 token 存入 fabric network 的 world state 中。同时会将 commit hash 等关键数据记录在区块中。该工具使用的框架是 nodejs。它适合用于编写轻量级的应用工具，并且易于界面化。可以认为是数据密集型分布式部署环境下的实时应用系统的完美解决方案。其提供非阻塞模式的IO处理带来在相对低系统资源能耗下的高性能和出众的负载能力。此外，fabric network 中 API 服务端也是使用的 nodejs，配合起来更便利。

Trustie 是一个供大众协同开发的群智平台。与 github 类似，它支持代码托管、代码clone、版本库上线等几乎所有的功能。通过集成 gitlab，使它可以安全、高效的对 git 仓库进行控制。到目前为止，该平台托管的项目已有数十万。大量的开发人员在该平台上进行协同办公。

Fabric Network 是整个平台的核心，基于 hyperledger fabric 搭建。它负责提供安全和可信的存储网络，所有 commit 交易记录都会保存在链上，以此来确保数据的安全可靠信。此外，平台会将对应的 commit 代码转换为一定数量的 token，然后累加到提交该次 commit 的 user 账号中。

### 2.1 Token 计算的两种途径

开源世界中存在大量的开源项目。开发者参与开源项目的方式可以有多种，如：issues、pull request、push 以及 comment 等。但是开发者想直接修改代码的途径只能通过 push 或 pull request 的方式。这就涉及到开发者的两种身份：核心开发者和外围开发者。核心开发者拥有整个项目的最高权力，可以直接 push 已修改的最新代码至远程仓库，而且可以审核、判断是否合并外围开发者发起的 pull request 请求。外围开发者只能通过发起 pull request 的方式修改代码，前提是该请求被核心开发者所采纳并 merge 至最新的版本库。

本文中，我们会在区块中记录 push 和 pull request 操作的核心信息，将所有数据永久存证，借助区块链的特性保证数据的真实可信。此外，为了更好的刺激开发者持续高效的为开源世界、开源项目做贡献，平台设计了 Token 机制。开发者对项目源码所作的任意修改都可以获得 Token 奖励，比如增加一行代码奖励一点 Token 值。该 Token 值存储在 Fabric Network 的世界状态中，对世界状态的任意修改都会被区块链永久记录在区块中。为此，系统针对核心和外围开发者设计了不同的 Token 计算处理机制。

#### 2.1.1 核心开发者

核心开发者是开源项目中的贡献主力。正常情况下，一个开源项目中80% - 90% 的代码都来自核心开发者。传统分布式协作环境中，核心开发者在本地编辑完代码后就可以直接 push 托管至远程仓库，其它成员通过 pull 操作同步最新的代码版本。本文由于需要将 push 的核心信息以及 Token 值记录在区块链中，所以和传统的处理过程存在略微不同。

图二是核心开发者计算 Token 的机制流程图。首先用户调用 "chain push" 函数将本地 Repo 中最新的 commit 信息上传至 Trustie。然后，Trustie 更新 repository 信息，返回 result。然后，Chain Tool executes the ``Push'' function using curl command, which can send a request to the Fabric Network for saving push data. 然后，Fabric Network 调用 chaincode 向 Trustie 发起 Http request，目的是判断 push 内容是否真实存在，而不是人为作假。然后，在 Trustie 判断 push 内容真实后，计算该部分内容所得 token 值。最后,Trustie 返回 success 和 token 值。chaincode 根据返回的信息，将 push content 记录在区块链中，并更新该用户在 world state 中的状态。

![push process.png](https://ws1.sinaimg.cn/large/006alGmrly1g6vdguttuxj30jj0e1aax.jpg)

#### 2.1.2 外围开发者

开源世界中存在大量的外围开发者，他们通过 issues、comment、pull request 等形式参与开源社区、项目的建设。外围开发者虽然不同于核心开发者，没有对项目的实际管理权限，但是往往能提供非常有创新的点子，并且解决开源项目中棘手的难题。对此，记录、保存和奖励外围开发者所做的贡献是十分有必要的。本文仅考虑 pull request 功能。

图三则是外围开发者计算 Token 的机制流程图。先是外围开发者将 Fork Repo 中最新的 commit 记录提交至 Trustie 服务器。之后，开发者可以在自己的页面查看到最新的提交信息，并发起 Pull Request 请求。目的是将本次对 Fork Repo 的修改同步到原 Repo 中。原 Repo 核心开发者看到 Pull Request 请求后，评估该请求的价值，合格则合并该请求到当前原 Repo。同时，Trustie server 调用 Curl trustiePush 命令，将该次合并所作的贡献值 Token和关键数据传入 Fabric Network 中。chaincode 判断当前用户是否存在，不存在则在世界状态中开辟一个账户，然后更新对应用户的世界状态，并记录操作上链。

![pull request process.png](https://ws1.sinaimg.cn/large/006alGmrly1g6vdvafvo5j30r90aeab5.jpg)

### 2.2 Trustie Platform

Trustie 是构建面向群体化实践教学的支撑平台。它基于群体化实践教学的思想，围绕阅读和维护高质量的开源软件，以及开发有创意、上规模的软件系统两个方面。Trustie 平台涵盖了对开源代码阅读与评价、开源资源的分析与共享、实践项目的协同开发等群体化实践教学的支持，主要包括数据存储管理、核心支撑机制、关键子系统以及 Web 交互等

本文主要关注的是实践项目协同开发部分。其支持开源项目实践任务开展分布式协作实践，提供任务跟踪、协同开发等群体协同工具，以及代码质量、个体能力等持续评估工具。trustie 开发社区中的项目创建者覆盖了来自全国 150 多所高校的近 1000 名师生以及约 25个科研院所和创新实验室的科研人员，包括北斗开源实验室、国内首个机器人操作系统团队Micros、国际顶尖机器人竞技团队 Nubot 以及国家超级计算广州中心等。此外，还有超过 200 多名自由软件爱好者也在平台中通过项目贡献了自己的代码、开发经验以及心得文档等。

trustie 主要提供对代码仓库进行托管的服务。如图四所示，它可以提供项目目标规划、里程碑设置来控制项目工作的进展，保证目标规划的实现；提供项目任务（需求、功能、支持、缺陷等）分配管理机制，使开发过程能够有序进行；提供项目进度统计、分析、通知等，确保协作团队之间所修改的代码保持一致性和完整性；提供wiki、论坛等以实现群体知识分享与高效协同。此外，Trustie 需要验证来自 chaincode 数据的真实性，防止别人随意调用 API，破坏网络的建设。Trusite 还可以将开发人员对开源项目的贡献定量的转换为 Token，并记录在区块链上，永久保存。Token 占有比例可以在一定程度上说明开发人员对项目的总贡献程度。一旦有企业愿意收购该项目，Token 就可以兑换金钱，开发人员就可以获得相应的收益。目前，Token 计算的方式为：每添加或者删除一行代码均加1。

![image.png](https://ws1.sinaimg.cn/large/006alGmrly1g6vm0u4826j30j60edq4s.jpg)

### 2.3 Blockchcian Network

<!-- 简单介绍引入区块链网络的目的：为开发者贡献确权，激励开发者对开源项目的持续贡献
简单介绍 fabric 区块链特性
介绍架构图中各组件所支持的功能
点出一个项目即一个channel，一个区块链的机制。数据隔离存储和管理。 -->

总所周知，开源项目中获利的一方往往是核心开发者，拥有对项目管理的完整权限。外围贡献者很难获得任何好处，即使对项目做出非常大的帮助。对此，外围开发者很难持续对一个开源项目进行贡献，缺乏相应的激励机制，导致开源社区流失大量技术人员，项目计划无法按时完成，甚至严重到使项目夭折。本文提出用区块链的方法来解决这一问题。区块链技术因其数据不可篡改和可回溯的特性，非常适合用于存储历史版本数据。一旦数据有任何人为恶意修改，都会被很容易察觉。

本文采用 Hyperledger fabric 企业级联盟链技术搭建区块链网络。fabric 支持可插拔的共识机制和会员服务组件，为人熟知的共识机制有 kafka、raft，拥有远高于 bitcoin 和 ethereum 的 tps。追求模块化、扩展化、安全化，并且支持对数据的隔离存储，可以将不同项目的数据存储在不同的地方，并且互相不会产生影响。支持多通道功能，实现多业务隔离功能，具有高性能和高可伸缩性。

图 5 表示区块链网络的架构图，不同组件代表不同功能。其中 c 1、c 2 ... c n 表示channel ，对应开源社区中的开源项目，可动态添加删除。A1 表示 client application，本文中由 nodejs 编写，Hyperledger fabric 官方支持并提供大量的 SDK 用于调用区块链网络中的组件。R1 和 R2 是两个不同的组织，开源社区 Trustie 可充当其中一个组织，P1 和 P2 分别是这两个组织中的节点，可用于安装链码、交易背书、存储账本等。o 1 是 orderer 节点，负责达成网络中的共识，充当挖掘区块的角色。CC 1、CC 2 ... CC n是指不同的联盟，每创建一条 channel 都会产生一个新的联盟，组织 R1 和 R2 则是这些联盟中的成员。S 1 、S 2 ... S n 指的是智能合约，支持账号创建、Token 查询、chain push、chain trustiePush 等功能，每一个 channel 中都会实例化一份智能合约。L 1、L 2 ... L n 指的是账本信息，两个节点 P 1 和 P 2 会分别为每个 channel 存储一份账本信息，包括各自项目的区块和世界状态数据。channel 会连接 client application 、 两个 peer 节点 、orderer 节点以及组织联盟，构建一条独立的链条。

当开发者新建一个 git 项目时，平台可以为其生成对应的 channel，该 channel 与所建项目一一对应。开发者对项目的 push 和 pull request 操作都会被记录至该 channel 对应的区块链中，新增的 Token 则会被更新至世界状态中，以保证数据信息的高可靠信。

![微信图片_20190912162259.png](https://ws1.sinaimg.cn/large/006alGmrly1g6wt9mg4t0j30ns0foabd.jpg)

## 3. Related Work

### 3.1 Hyperledger fabric

比特币是一种点对点的电子加密货币系统，于2009年被一个号称是中本聪的人或组织提出。区块链则是它的主要核心技术。区块链可以被认为是一个公共账本，它由一个个区块通过 hash 值连接起来，每个区块中存储若干交易账本。其核心技术包括：加密 hash、数字签名和分布式共识机制等。具有安全性、透明性、自治性和高匿名性等优点。

hyperledger fabric是安全的企业级联盟链平台，支持节点管理和验证。每一个用户都可以通过证书彼此相连。可以非常安全的管理数据。主要源码贡献IBM。fabric 是一个分布式账本平台的实现，该平台利用熟悉和成熟的技术运行智能合约，采用模块化架构，允许各种功能的可插拔实现。fabric 分布式账本协议运行在 peers 节点上。peers 节点角色分两种，一种是 validating peer，用于出块达成共识。另一种是 non-validating peer，用于为交易背书，存储区块等。

### 3.2 Blockchain in Intellectual Property Protection

近年来，知识产权保护问题越来越受到大众关注，因为仿冒产品和商标每年将会造成数千亿美元的损失。Zuleika Beaven, et al. 思考音乐产业和区块链技术的结合，利用区块链技术对音乐作品进行知识产权保护Soundchain 平台就是其中的一个代表，在 Russia 被广泛用于承担音乐产业领域的产权保护活动

在工业 4.0 时代，3D 打印技术是一项革命性的创新。有人认为该制造流程是一个商品。但是整个产业链都被版权问题所困扰。Martin HOLLAND, et al. 结合区块链技术将整个过程链商业化实施的同时，有效的防止知识产权盗窃。一旦有途中有任何风险，都可以被识别，并提供相应的解决方案。目前该方案正在由一个名为 SAMPL 的项目开发

相对于音乐和3D打印产业，艺术品图像版权问题并不受大众所重视。但其在网络上的肆意传播会给创作者和整个产业链带来严重的危害。 Ma Zhaofeng, et al. 提出了一种基于水印和区块链的艺术品图像数字版权管理方案，具有高鲁棒性和安全性。一旦网络上可疑的图像数据被滥用，未经授权在网络上传播，就可以通过该系统来追踪盗用人的责任。

CKshare 是一个基于私有云和区块链技术的可信赖的模具再设计知识共享平台。它使用私有云存储模具的原始数据，利用区块链网络对模具数据和交易进行记录，以保证数据的安全性和可靠性。该平台可扩展到其它类似的应用场景。

利用区块链技术进行知识产权保护的领域有很多，包括音乐、图像、影音、3D打印等电子媒介数据以及各种产品供应链。但是应用在开源贡献记录上的确很少。

### 3.3 Blockchain in Open Innovation

区块链技术最初致力于为比特币提供动力，现在正日益证明它在许多其他用途上的适用性。开放创新的定义描述为由区块链技术和衍生产品支持的分布式可靠解决方案

Gitcoin 是一个基于以太坊区块链的分布式应用程序，目的是让人们在开源的贡献中获得奖励。它希望建立一个每个人远离财务烦恼来进行工作的世界。它提供了一个空间，允许开源开发人员为开源项目工作并获得报酬，相应的开源项目则可以接触到大量优秀开发人员来参与。 悬赏人将悬赏规则写入智能合约中，如完成某个开发功能奖励若干以太币或比特币。开发人员完成悬赏任务，悬赏人确定该任务被完成后即可触发智能合约，自动完成交易。

Gitcoin 有一个缺点就是需要悬赏者手动确认开发人员提交的工作是否满足悬赏要求。这个过程是可以作假的，即使开发人员提交的工作满足要求，悬赏人也可以单方面毁约。对此，ChainSoft 使用 Ethereum Smart contract 、 Github/Travis CI 和 Oracles 完善了该功能。使该过程可以变成自动代码验证，而不需要悬赏者手动参与。验证完成后如果满足要求则强制执行智能合约完成剩余的交易。但该方法需要悬赏者提前编写好若干测试用例，实施难度较大。

Josep Lluis de la Rosa, et al. 所做的工作旨在为中小型企业提供正确的 Open Innovation 知识产权保护。并且利用区块链和智能合约技术开发了一个Networked Innovation Rooms (NIR)。这将有助于降低中小企业对信息时代知识产权的担忧。

## 4. Workflows of BBCPS

为了更安全的数据存储和记录开发者贡献，当前， BBCPS 系统主要支持三个模块的功能，分别是 CreateProject Function、Push Function 以及 Pull Request Function。

### 4.1 Workflows of CreateProject Function

基于 Trustie 平台和 Hyperledger fabric 联盟链的特性，我们每次使用 chain tool 创建项目后，都会在 Trustie 平台上生成该项目对应的远程版本仓库，同时会在 Blockchain Network 中生成对应的 channel。

图四是 CreateProject Function 的流程图。开发者调用 Chain Tool 工具创建项目，并输入项目名。Trustie 核实开发者身份，确认新建项目不存在后为开发者创建 git 远程版本仓库，并将 git 仓库地址返回。开发者 clone 该仓库至本地。接下来 Chain Tool 发起 Curl CreateChannel 请求，Fabric Network 检查 channel 是否存在，不存在则调用配置文件生成 channel，实例化 chaincode，返回 success。至此，git 项目和其 channel 创建成功。

### 4.2 Workflows of Push Functio

Push 是平台的核心功能之一。它是开源项目中核心开发者实时更新本地代码至远程仓库的基础，同时也会将更新的内容和对应的贡献值记录在区块链中。

### 4.3 Workflows of Pull Request Function

外围开发者通过 Pull Request 功能可以直接参与开源项目的建设，为其修改漏洞，编写新功能，优化代码等。一旦 Pull Request 被核心开发者采纳，外围开发者就能获得符合贡献的物质激励。

## 5. Conclusion

本文，我们提出了一个分布式、安全、可信的 BBCP 平台，用于永久记录开源项目中开发者所作的贡献并为开发者分配股权。基于 Hyperledger Fabric 搭建的区块链网络为系统数据传输和存储提供了安全可靠保障。开源社区 Trustie 平台则支持多人对开源项目的群智协同开发，并记录贡献占比至区块中。基于该系统，开源项目可以激励开发者，并吸引其对项目进行持续性开发。
In the future, the work can be extended to address the following issues:

1. 建立健全物质激励机制。现有工作只考虑了 push 和 pull request 功能，缺乏对 issues、comment 的深入分析，而后者也对开源项目进行了贡献。此外， push 和 pull request 中贡献分配的形式过于单一，仅靠代码增减判断贡献大小。

2. 替换合适的共识机制。当前 Hyperleger 支持的共识机制都是非 BPFT 的，一旦网络中存在作恶的节点就会导致系统瘫痪。对此，我们需要寻找或者设计适合 BBCP 应用场景的共识机制。

3. 对平台进行测评和优化。系统性能，如每秒交易次数等，是区块链系统至关重要的部分，这将严重影响到未来平台的发展和扩容。这也是目前 Bitcoin 、 Ethereum 等区块链平台最棘手的问题。
